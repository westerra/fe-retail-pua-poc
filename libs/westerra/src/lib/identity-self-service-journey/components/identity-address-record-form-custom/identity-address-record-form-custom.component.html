<div *ngIf="form && (profile$ | async)">
  <form [formGroup]="form" (submit)="formSubmit$.next(true); formSubmitted = true">
    <div class="bb-block bb-block--lg">
      <bb-input-text-ui
        class="bb-form-field bb-form-field--md"
        data-role="user-manage-profile-postal-manage-line-1"
        i18n-label="
          Label for the building number
          field@@bb-user-profile-features.address-record-form.input-label-text.building-number"
        label="Address line 1"
        formControlName="buildingNumber"
        [required]="true"
        [maxLength]="255"
        (ngModelChange)="checkAddressValidation('buildingNumber', form)"
      >
      </bb-input-text-ui>
      <bb-input-validation-message-ui [showErrors]="(showBuildingNumberRequiredError$ | async) || false">
        <span
          i18n="
            Address line 1 required
            error@@bb-user-profile-features.address-record-form.validation-text.provide-address-line-1"
        >
          You must enter a value for Address line 1.
        </span>
      </bb-input-validation-message-ui>
      <bb-input-validation-message-ui [showErrors]="(showBuildingNumberInvalidError$ | async) || false">
        <span
          i18n="
            Address line 1 invalid
            error@@bb-user-profile-features.address-record-form.validation-text.invalid-address-line-1"
        >
          Invalid format
        </span>
      </bb-input-validation-message-ui>
      <bb-input-validation-message-ui [showErrors]="form?.get('buildingNumber').errors?.POBox">
        <span data-role="validation-error-check-number-digits-only" *ngIf="form?.get('buildingNumber').errors?.POBox">
          P.O. boxes cannot be used for "Home" addresses. Please choose "Mailing" as the address type to add a P.O. box
        </span>
      </bb-input-validation-message-ui>
    </div>
    <div class="bb-block bb-block--lg">
      <bb-input-text-ui
        class="bb-form-field bb-form-field--md"
        data-role="user-manage-profile-postal-manage-line-2"
        i18n-label="
          Label for the street name field@@bb-user-profile-features.address-record-form.input-label-text.street-name"
        label="Address line 2 (optional)"
        formControlName="streetName"
        [maxLength]="255"
        (ngModelChange)="checkAddressValidation('streetName', form)"
      >
      </bb-input-text-ui>
      <bb-input-validation-message-ui [showErrors]="form?.get('streetName').errors?.POBox">
        <span data-role="validation-error-check-number-digits-only" *ngIf="form?.get('streetName').errors?.POBox">
          P.O. boxes cannot be used for "Home" addresses. Please choose "Mailing" as the address type to add a P.O. box
        </span>
      </bb-input-validation-message-ui>
    </div>
    <div class="bb-block bb-block--lg">
      <bb-input-text-ui
        class="bb-form-field bb-form-field--md"
        data-role="user-manage-profile-postal-manage-city"
        i18n-label="
          Label for the town name field@@bb-user-profile-features.address-record-form.input-label-text.town-name"
        label="City or town"
        formControlName="townName"
        [required]="true"
        [maxLength]="35"
      >
      </bb-input-text-ui>
      <bb-input-validation-message-ui [showErrors]="(showCityTownRequiredError$ | async) || false">
        <span
          i18n="
            City or town required
            error@@bb-user-profile-features.address-record-form.validation-text.provide-city-or-town"
        >
          You must enter a value for City or town.
        </span>
      </bb-input-validation-message-ui>
      <bb-input-validation-message-ui [showErrors]="(showCityTownInvalidError$ | async) || false">
        <span
          i18n="
            City or town invalid
            error@@bb-user-profile-features.address-record-form.validation-text.invalid-city-or-town"
        >
          Invalid format
        </span>
      </bb-input-validation-message-ui>
    </div>

    <!-- Country dropdown -->
    <!-- <div class="bb-block bb-block--lg">
      <bb-dropdown-single-select-ui
        label="Country"
        class="bb-form-field bb-form-field--sm"
        [required]="true"
        id="countrySingleSelect"
        formControlName="country"
      >
        <bb-dropdown-single-select-option-ui
          *ngFor="let state of countryOptions"
          class="text-capitalize"
          [value]="state.value"
          [label]="state.label"
          for="countrySingleSelect"
        >
        </bb-dropdown-single-select-option-ui
      ></bb-dropdown-single-select-ui>
      <bb-input-validation-message-ui [showErrors]="this.form?.controls?.country?.errors?.required && formSubmitted">
        <span
          i18n="
            State, province or region required
            error@@bb-user-profile-features.address-record-form.validation-text.provide-state-province-or-region"
        >
          You must select a value for Country.
        </span>
      </bb-input-validation-message-ui>
    </div> -->

    <div class="bb-block bb-block--lg" [hidden]="nonUSCountrySelected">
      <!-- <bb-input-text-ui
        class="bb-form-field bb-form-field--sm"
        data-role="user-manage-profile-postal-manage-state"
        i18n-label="
          Label for the country sub-division
          field@@bb-user-profile-features.address-record-form.input-label-text.sub-division"
        label="State, province or region"
        formControlName="countrySubDivision"
        [required]="true"
        [maxLength]="35"
      >
      </bb-input-text-ui> -->
      <bb-dropdown-single-select-ui
        label="State"
        class="bb-form-field bb-form-field--sm"
        [required]="true"
        id="countrySubDivisionSingleSelect"
        formControlName="countrySubDivision"
      >
        <bb-dropdown-single-select-option-ui
          *ngFor="let state of countrySubDivisionOptions"
          class="text-capitalize"
          [value]="state.value"
          [label]="state.label"
          for="countrySubDivisionSingleSelect"
        >
        </bb-dropdown-single-select-option-ui
      ></bb-dropdown-single-select-ui>
      <bb-input-validation-message-ui [showErrors]="(showCountrySubDivisionRequiredError$ | async) || false">
        <span
          i18n="
            State, province or region required
            error@@bb-user-profile-features.address-record-form.validation-text.provide-state-province-or-region"
        >
          You must select a value for State, province or region.
        </span>
      </bb-input-validation-message-ui>
      <bb-input-validation-message-ui [showErrors]="(showCountrySubDivisionInvalidError$ | async) || false">
        <span
          i18n="
            State, province or region invalid
            error@@bb-user-profile-features.address-record-form.validation-text.invalid-state-province-or-region"
        >
          Invalid format
        </span>
      </bb-input-validation-message-ui>
    </div>
    <div class="bb-block bb-block--lg">
      <bb-input-text-ui
        class="bb-form-field bb-form-field--xs"
        data-role="user-manage-profile-postal-manage-post-code"
        i18n-label="
          Label for the postal code field@@bb-user-profile-features.address-record-form.input-label-text.postal-code"
        label="Postal or ZIP code"
        formControlName="postalCode"
        [required]="true"
        [minlength]="5"
        [maxLength]="10"
        (input)="formatPostcode($event, form)"
        #postalCode
      >
      </bb-input-text-ui>
      <bb-input-validation-message-ui [showErrors]="(showPostcodeRequiredError$ | async) || false">
        <span
          i18n="
            Postal or ZIP code required
            error@@bb-user-profile-features.address-record-form.validation-text.provide-postal-or-zip-code"
        >
          You must enter a value for Postal or ZIP code.
        </span>
      </bb-input-validation-message-ui>
      <bb-input-validation-message-ui [showErrors]="(showPostcodeInvalidError$ | async) || false">
        <span
          i18n="
            Postal or ZIP code invalid
            error@@bb-user-profile-features.address-record-form.validation-text.invalid-postal-or-zip-code"
        >
          Invalid format
        </span>
      </bb-input-validation-message-ui>
      <bb-input-validation-message-ui [showErrors]="form?.get('postalCode').errors?.minlength">
        <span data-role="validation-error-check-number-digits-only" *ngIf="form?.get('postalCode').errors?.minlength">
          Postal code should have minimum 5 digits
        </span>
      </bb-input-validation-message-ui>
      <bb-input-validation-message-ui
        [showErrors]="!form?.get('postalCode').errors?.minlength && form?.get('postalCode').errors?.postcodeminlength"
      >
        <span
          data-role="validation-error-check-number-digits-only"
          *ngIf="form?.get('postalCode').errors?.postcodeminlength"
        >
          Postal code should have minimum 9 digits matching the pattern "00000-0000"
        </span>
      </bb-input-validation-message-ui>
    </div>
    <div class="bb-block bb-block--lg" *ngIf="postalAddressIsPrimaryEnabled && !isEditMode">
      <bb-input-checkbox-ui
        data-role="user-manage-profile-address-manage-primary"
        label="This is my primary address"
        i18n-label="
          Make primary checkbox label@@bb-user-profile-features.address-record-form.input-label-text.address-primary"
        formControlName="primary"
      >
      </bb-input-checkbox-ui>
    </div>
    <div class="bb-block bb-block--lg" *ngIf="postalAddressSelectTypeEnabledValue && !isEditMode">
      <bb-input-radio-group-ui
        data-role="user-manage-profile-address-manage-type"
        formControlName="type"
        label="Address type"
        i18n-label="
          Label for postal address type radio
          options@@bb-user-profile-features.address-record-form.input-label-text.address-type"
        [preselect]="false"
        [required]="true"
        (ngModelChange)="updateAddressValidation(form)"
      >
        <bb-input-radio-ui
          *ngFor="let option of addressTypeOptions"
          [value]="option"
          [label]="option"
          [disabled]="checkIfDisbaled(option)"
        >
        </bb-input-radio-ui>
      </bb-input-radio-group-ui>
      <bb-input-validation-message-ui [showErrors]="(showAddressTypeError$ | async) || false">
        <span
          i18n="
            Address type required
            error@@bb-user-profile-features.address-record-form.validation-text.address-type-required"
        >
          Choose an address type
        </span>
      </bb-input-validation-message-ui>
    </div>
    <div class="bb-button-bar bb-button-bar--reverse">
      <bb-load-button-ui
        *ngIf="!postalAddressRecordValue"
        type="submit"
        data-role="user-manage-profile-address-manage-save"
        class="bb-button-bar__button"
        [isLoading]="saveLoading"
        i18n="Add address button action@@bb-user-profile-features.address-record-form.button-text.add-address"
      >
        Add address
      </bb-load-button-ui>
      <bb-load-button-ui
        *ngIf="postalAddressRecordValue"
        type="submit"
        data-role="user-manage-profile-address-manage-save"
        class="bb-button-bar__button"
        [isLoading]="saveLoading"
        i18n="Save postal address button action@@bb-user-profile-features.address-record-form.button-text.save-changes"
      >
        Save changes
      </bb-load-button-ui>
      <button
        bbButton
        data-role="user-manage-profile-manage-cancel-button"
        color="secondary"
        class="bb-button-bar__button"
        type="button"
        (click)="cancelClick.emit()"
        i18n="Cancel changes button action@@bb-user-profile-features.address-record-form.button-text.cancel"
      >
        Cancel
      </button>
    </div>
  </form>
</div>
